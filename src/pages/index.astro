---
import Layout from '../layouts/Layout.astro';
import Newsletter from '../components/Newsletter.astro';
import { db } from '../db';
import { news } from '../db/schema';
import { desc, eq, ne, and } from 'drizzle-orm';
import { Image } from 'astro:assets';
import wikiHeroImage from '../assets/wiki_hero.png';

// Get featured news (highest featured level or most recent)
const [featuredNews] = await db.select().from(news)
	.where(eq(news.published, true))
	.orderBy(desc(news.featuredLevel), desc(news.createdAt))
	.limit(1);

// Get other news, excluding the featured one
const allNews = await db.select().from(news)
	.where(
		and(
			eq(news.published, true),
			featuredNews ? ne(news.id, featuredNews.id) : undefined
		)
	)
	.orderBy(desc(news.createdAt))
	.limit(9);

export const prerender = false;
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Inox Link",
  "url": "https://inoxlink.com.br/",
  "description": "O principal portal brasileiro de notícias e conhecimento técnico sobre aço inox.",
  "publisher": {
    "@type": "Organization",
    "name": "Inox Link",
    "logo": {
      "@type": "ImageObject",
      "url": "https://inoxlink.com.br/favicon_inox_link.svg"
    }
  }
};
---

<Layout 
	title="Inox Link - Seu Portal de Aço Inoxidável"
	description="O principal portal brasileiro de notícias, normas técnicas e conhecimento especializado sobre aço inoxidável. Explore nossa Wiki e as últimas notícias do setor."
	canonicalUrl="https://inoxlink.com.br"
	jsonLd={jsonLd}
>
    <!-- Premium Dark Hero Section -->
    <section class="relative bg-black text-white py-8 md:py-12 overflow-hidden rounded-b-[3rem] -mb-12 z-10 -mt-20 pt-20 md:pt-24">
        <!-- Texture/Noise Overlay -->
        <div class="absolute inset-0 opacity-[0.03] pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
        <!-- Gradient Glow -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full bg-[radial-gradient(circle_at_50%_-20%,#333_0%,transparent_70%)] opacity-50"></div>
        
        <div class="relative w-full px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-2xl md:text-4xl lg:text-5xl font-black tracking-tighter leading-tight uppercase italic mb-0 animate-in fade-in slide-in-from-bottom-4 duration-700">
                O ELO ENTRE <span class="text-zinc-500">INDÚSTRIA E</span> CONHECIMENTO.
            </h1>
        </div>
    </section>

	<div class="bg-white pt-12">
		<!-- Hero Section - Featured News -->
		{featuredNews && (
			<section class="border-b border-zinc-100">
				<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 lg:py-16">
					<a href={`/noticias/${featuredNews.slug}`} class="group grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center">
						<!-- Image -->
						<div class="relative aspect-[16/10] lg:aspect-[4/3] overflow-hidden rounded-2xl bg-zinc-100 order-2 lg:order-1">
							{featuredNews.imageUrl && (
								<Image
									src={featuredNews.imageUrl}
									alt={featuredNews.imageAlt || featuredNews.title}
									width={800}
									height={600}
									format="webp"
									quality={85}
									loading="eager"
									fetchpriority="high"
									class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
								/>
							)}
							<div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
						</div>

						<!-- Content -->
						<div class="space-y-6 order-1 lg:order-2">
							<div class="flex items-center gap-3">
								<span class="inline-block px-3 py-1 bg-black text-white text-[10px] font-bold uppercase tracking-widest rounded-full">
									Em Destaque
								</span>
								<span class="text-xs text-zinc-600 font-medium">
									<time datetime={new Date(featuredNews.createdAt || '').toISOString()}>
										{new Date(featuredNews.createdAt || '').toLocaleDateString('pt-BR', { 
											day: 'numeric', 
											month: 'long', 
											year: 'numeric' 
										})}
									</time>
								</span>
							</div>
							
							<h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight leading-tight text-zinc-900 group-hover:text-zinc-700 transition-colors">
								{featuredNews.title}
							</h2>

							{featuredNews.excerpt && (
								<p class="text-lg text-zinc-600 leading-relaxed line-clamp-3">
									{featuredNews.excerpt}
								</p>
							)}

							<div class="flex items-center gap-2 text-sm font-medium text-zinc-900">
								Ler matéria completa
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform group-hover:translate-x-1"><line x1="5" x2="19" y1="12" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
							</div>
						</div>
					</a>
				</div>
			</section>
		)}

		<!-- Latest News Grid -->
		<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-20">
			<div class="flex items-center justify-between mb-10">
				<h2 class="text-2xl sm:text-3xl font-bold tracking-tight text-zinc-900">Últimas Notícias</h2>
				<a href="/noticias" class="text-sm font-bold text-zinc-500 hover:text-black transition-colors flex items-center gap-1">
					Ver todas
					<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" x2="19" y1="12" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
				</a>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-10">
				{allNews.length > 0 ? allNews.map((item) => (
					<article>
						<a href={`/noticias/${item.slug}`} class="group block space-y-4">
							<!-- Image -->
							<div class="relative aspect-[16/10] overflow-hidden rounded-xl bg-zinc-100">
								{item.imageUrl && (
									<Image 
										src={item.imageUrl} 
										alt={item.title} 
										width={400}
										height={250}
										format="webp"
										quality={75}
										loading="lazy"
										class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
									/>
								)}
							</div>

							<!-- Content -->
							<div class="space-y-3">
								<div class="flex items-center gap-2 text-[11px] font-bold text-zinc-700">
									<time datetime={new Date(item.createdAt || '').toISOString()}>
										{new Date(item.createdAt || '').toLocaleDateString('pt-BR', { 
											day: 'numeric', 
											month: 'short' 
										})}
									</time>
									{item.readingTime && (
										<>
											<span>•</span>
											<span>{item.readingTime} min</span>
										</>
									)}
								</div>

								<h3 class="text-xl font-bold leading-tight text-zinc-900 group-hover:text-zinc-600 transition-colors line-clamp-2">
									{item.title}
								</h3>

								{item.excerpt && (
									<p class="text-sm text-zinc-600 line-clamp-2 leading-relaxed">
										{item.excerpt}
									</p>
								)}
							</div>
						</a>
					</article>
				)) : (
					<div class="col-span-full py-20 text-center">
						<div class="inline-flex w-16 h-16 bg-zinc-100 rounded-full items-center justify-center mb-4">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-zinc-400"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8"/><path d="M15 18h-5"/><path d="M10 6h8v4h-8V6Z"/></svg>
						</div>
						<p class="text-zinc-400 font-medium">Nenhuma notícia publicada no momento.</p>
					</div>
				)}
			</div>
		</section>

		<!-- Wiki CTA Section -->
		<section class="bg-zinc-50 border-y border-zinc-100" aria-labelledby="wiki-cta-title">
			<h2 id="wiki-cta-title" class="sr-only">Conheça a Inox Wiki</h2>
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-20">
				<div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-center">
					<!-- Content -->
					<div class="space-y-6 order-2 lg:order-1">
						<div class="inline-flex items-center gap-2 px-3 py-1.5 bg-white rounded-full border border-zinc-200">
							<div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
							<span class="text-[10px] font-bold uppercase tracking-widest text-zinc-800">Base de Conhecimento</span>
						</div>

						<h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold tracking-tight leading-tight text-zinc-900">
							Inox Wiki: Seu Guia Técnico Completo
						</h2>

						<p class="text-lg text-zinc-600 leading-relaxed max-w-xl">
							Aprenda sobre tipos de acabamento, resistência à corrosão, normas técnicas e tudo o que você precisa saber para especificar o material correto.
						</p>

						<div class="flex flex-wrap gap-2">
							<span class="px-3 py-1.5 bg-white border border-zinc-200 rounded-lg text-xs font-medium text-zinc-600">#AISI304</span>
							<span class="px-3 py-1.5 bg-white border border-zinc-200 rounded-lg text-xs font-medium text-zinc-600">#Acabamento</span>
							<span class="px-3 py-1.5 bg-white border border-zinc-200 rounded-lg text-xs font-medium text-zinc-600">#Corrosão</span>
							<span class="px-3 py-1.5 bg-white border border-zinc-200 rounded-lg text-xs font-medium text-zinc-600">#Normas</span>
						</div>

						<div class="pt-2">
							<a href="/wiki" class="inline-flex items-center gap-2 px-6 py-3 bg-black text-white text-sm font-bold rounded-xl hover:bg-zinc-800 transition-all shadow-lg active:scale-95">
								Explorar Wiki
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" x2="19" y1="12" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
							</a>
						</div>
					</div>

					<!-- Image -->
					<div class="relative order-1 lg:order-2">
						<div class="aspect-[4/3] bg-white rounded-2xl overflow-hidden border border-zinc-200 shadow-xl shadow-zinc-200/50">
							<Image 
								src={wikiHeroImage} 
								alt="Inox Wiki - Conhecimento Técnico" 
								width={600}
								format="webp"
								quality={85}
								loading="lazy"
								class="w-full h-full object-cover"
							/>
						</div>
						<!-- Decorative element -->
						<div class="absolute -bottom-6 -right-6 w-32 h-32 bg-zinc-900 rounded-2xl -z-10 hidden lg:block"></div>
					</div>
				</div>
			</div>
		</section>
		
		<!-- Newsletter Section -->
		<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-20">
			<Newsletter />
		</section>
	</div>
</Layout>

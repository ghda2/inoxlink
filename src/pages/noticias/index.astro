---
import Layout from '../../layouts/Layout.astro';
import { db } from '../../db';
import { news } from '../../db/schema';
import { desc } from 'drizzle-orm';

const allNews = await db.select().from(news).orderBy(desc(news.createdAt));

export const prerender = false;
---

<Layout title="Notícias" description="Fique por dentro das últimas novidades do mundo do aço inox.">
    <div class="space-y-12">
        <header class="space-y-4">
            <h1 class="text-5xl font-black tracking-tighter italic uppercase">Notícias</h1>
            <p class="text-neutral-500 text-lg font-medium max-w-2xl">
                Acompanhe lançamentos, tendências de mercado e atualizações técnicas do setor de inoxidáveis.
            </p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {allNews.map((item) => (
                <a href={`/noticias/${item.slug}`} class="group space-y-4">
                    <div class="relative aspect-video overflow-hidden rounded-2xl bg-neutral-100 border border-neutral-200">
                        {item.imageUrl && (
                            <img 
                                src={item.imageUrl} 
                                alt={item.title} 
                                class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
                            />
                        )}
                        <div class="absolute inset-0 bg-black/5 group-hover:bg-black/0 transition-colors"></div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex items-center gap-2 text-[10px] font-black text-neutral-400 uppercase tracking-widest">
                            <span>{new Date(item.createdAt || '').toLocaleDateString('pt-BR')}</span>
                        </div>
                        <h2 class="text-xl font-bold leading-tight group-hover:text-neutral-600 transition-colors uppercase">
                            {item.title}
                        </h2>
                        <p class="text-sm text-neutral-500 line-clamp-2 font-medium">
                            {item.excerpt}
                        </p>
                    </div>
                </a>
            ))}
        </div>
    </div>
</Layout>

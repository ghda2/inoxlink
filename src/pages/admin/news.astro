---
import AdminLayout from '../../layouts/AdminLayout.astro';
import { db } from '../../db';
import { news } from '../../db/schema';
import { desc } from 'drizzle-orm';

const allNews = await db.select().from(news).orderBy(desc(news.createdAt));
---

<AdminLayout title="Matérias">
  <div slot="header-actions">
    <a href="/admin/news/new" class="px-8 py-4 bg-white text-black rounded-2xl font-black text-xs uppercase tracking-[0.2em] shadow-2xl hover:bg-zinc-200 transition-all active:scale-[0.98]">
      + Criar Novo
    </a>
  </div>

  <div class="bg-zinc-900/50 border border-white/5 rounded-[2rem] overflow-hidden backdrop-blur-sm">
    <div class="overflow-x-auto">
        <table class="w-full text-left min-w-[600px]">
          <thead>
            <tr class="border-b border-white/5 bg-black/40">
              <th class="px-8 py-6 font-black text-zinc-500 text-[10px] uppercase tracking-[0.2em]">Conteúdo</th>
              <th class="px-8 py-6 font-black text-zinc-500 text-[10px] uppercase tracking-[0.2em]">Status</th>
              <th class="px-8 py-6 font-black text-zinc-500 text-[10px] uppercase tracking-[0.2em]">Data</th>
              <th class="px-8 py-6 font-black text-zinc-500 text-[10px] uppercase tracking-[0.2em] text-right">Ações</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-white/5">
            {allNews.map((item) => (
              <tr class="hover:bg-white/[0.02] transition-colors group">
                <td class="px-8 py-6">
                  <span class="font-bold text-lg text-white block uppercase tracking-tight group-hover:text-white transition-colors">{item.title}</span>
                  <span class="text-[10px] text-zinc-600 font-mono font-bold tracking-widest mt-1 block">URL: /{item.slug}</span>
                </td>
                <td class="px-8 py-6">
                  {item.published ? (
                    <span class="px-3 py-1.5 bg-white text-black text-[9px] font-black uppercase tracking-widest rounded-md">Publicado</span>
                  ) : (
                    <span class="px-3 py-1.5 border border-white/10 text-zinc-500 text-[9px] font-black uppercase tracking-widest rounded-md">Draft</span>
                  )}
                </td>
                <td class="px-8 py-6">
                  <span class="text-[10px] font-black text-zinc-500 uppercase tracking-widest leading-none">
                    {new Date(item.createdAt || '').toLocaleDateString('pt-BR')}
                  </span>
                </td>
                <td class="px-8 py-6 text-right">
                    <div class="flex justify-end gap-6 uppercase text-[10px] font-black tracking-widest">
                        <a href={`/admin/news/${item.id}`} class="text-zinc-500 hover:text-white transition-colors">Editar</a>
                        <button class="text-red-500/50 hover:text-red-500 transition-colors" onclick={`if(confirm('Tem certeza?')) window.location.href='/admin/news/delete/${item.id}'`}>Deletar</button>
                    </div>
                </td>
              </tr>
            ))}

            {allNews.length === 0 && (
              <tr>
                <td colspan="4" class="px-8 py-20 text-center">
                  <div class="text-zinc-800 text-4xl font-black italic uppercase tracking-tighter mb-2">Sem Matérias</div>
                  <p class="text-zinc-600 text-[10px] font-bold uppercase tracking-[0.2em]">Seu jornalismo começa no botão ali em cima</p>
                </td>
              </tr>
            )}
          </tbody>
        </table>
    </div>
  </div>
</AdminLayout>
